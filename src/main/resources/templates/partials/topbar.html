<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<body>
	<div th:fragment="topbar" th:remove="tag">
		<header id="page-topbar">
			<div class="layout-width">
				<div class="navbar-header">
					<div class="d-flex">
						<!-- LOGO -->
						<div class="navbar-brand-box horizontal-logo">
							<a href="/" class="logo logo-dark"> <span class="logo-sm">
									<img src="/assets/images/logo-sm.png" alt="" height="22">
							</span> <span class="logo-lg"> <img
									src="/assets/images/logo-dark.png" alt="" height="17">
							</span>
							</a> <a href="/" class="logo logo-light"> <span class="logo-sm">
									<img src="/assets/images/logo-sm.png" alt="" height="22">
							</span> <span class="logo-lg"> <img
									src="/assets/images/logo-light.png" alt="" height="17">
							</span>
							</a>
						</div>
						<input type="hidden" id="emp_id" th:value="${#authentication.name}">
						<button type="button"
							class="btn btn-sm px-3 fs-16 header-item vertical-menu-btn topnav-hamburger"
							id="topnav-hamburger-icon">
							<span class="hamburger-icon"> <span></span> <span></span>
								<span></span>
							</span>
						</button>

						<!-- App Search-->
						<!-- <form class="app-search d-none d-md-block">
							<div class="position-relative">
								<input type="text" class="form-control" placeholder="Search..." autocomplete="off"
									id="search-options" value="">
								<span class="mdi mdi-magnify search-widget-icon"></span>
								<span class="mdi mdi-close-circle search-widget-icon search-widget-icon-close d-none"
									id="search-close-options"></span>
							</div>
							<div class="dropdown-menu dropdown-menu-lg" id="search-dropdown">
								<div data-simplebar style="max-height: 320px;">
									item
									<div class="dropdown-header">
										<h6 class="text-overflow text-muted mb-0 text-uppercase">Recent Searches</h6>
									</div>

									<div class="dropdown-item bg-transparent text-wrap">
										<a href="index.html" class="btn btn-soft-secondary btn-sm btn-rounded">how to
											setup <i class="mdi mdi-magnify ms-1"></i></a>
										<a href="index.html" class="btn btn-soft-secondary btn-sm btn-rounded">buttons
											<i class="mdi mdi-magnify ms-1"></i></a>
									</div>
									item
									<div class="dropdown-header mt-2">
										<h6 class="text-overflow text-muted mb-1 text-uppercase">Pages</h6>
									</div>

									item
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<i class="ri-bubble-chart-line align-middle fs-18 text-muted me-2"></i>
										<span>Analytics Dashboard</span>
									</a>

									item
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<i class="ri-lifebuoy-line align-middle fs-18 text-muted me-2"></i>
										<span>Help Center</span>
									</a>

									item
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<i class="ri-user-settings-line align-middle fs-18 text-muted me-2"></i>
										<span>My account settings</span>
									</a>

									item
									<div class="dropdown-header mt-2">
										<h6 class="text-overflow text-muted mb-2 text-uppercase">Members</h6>
									</div>

									<div class="notification-list">
										item
										<a href="javascript:void(0);" class="dropdown-item notify-item py-2">
											<div class="d-flex">
												<img src="/assets/images/users/avatar-2.jpg"
													class="me-3 rounded-circle avatar-xs" alt="user-pic">
												<div class="flex-1">
													<h6 class="m-0">Angela Bernier</h6>
													<span class="fs-11 mb-0 text-muted">Manager</span>
												</div>
											</div>
										</a>
										item
										<a href="javascript:void(0);" class="dropdown-item notify-item py-2">
											<div class="d-flex">
												<img src="/assets/images/users/avatar-3.jpg"
													class="me-3 rounded-circle avatar-xs" alt="user-pic">
												<div class="flex-1">
													<h6 class="m-0">David Grasso</h6>
													<span class="fs-11 mb-0 text-muted">Web Designer</span>
												</div>
											</div>
										</a>
										item
										<a href="javascript:void(0);" class="dropdown-item notify-item py-2">
											<div class="d-flex">
												<img src="/assets/images/users/avatar-5.jpg"
													class="me-3 rounded-circle avatar-xs" alt="user-pic">
												<div class="flex-1">
													<h6 class="m-0">Mike Bunch</h6>
													<span class="fs-11 mb-0 text-muted">React Developer</span>
												</div>
											</div>
										</a>
									</div>
								</div>

								<div class="text-center pt-3 pb-1">
									<a href="/pages-search-results" class="btn btn-primary btn-sm">View All Results
										<i class="ri-arrow-right-line ms-1"></i></a>
								</div>
							</div>
						</form> -->
					</div>

					<div class="d-flex align-items-center">






						<!-- <div class="dropdown topbar-head-dropdown ms-1 header-item">
							<button type="button" class="btn btn-icon btn-topbar btn-ghost-secondary rounded-circle"
								data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">

								<i class='bx bx-category-alt fs-22'></i>
							</button>
							<div class="dropdown-menu dropdown-menu-lg p-0 dropdown-menu-end">
								<div
									class="p-3 border-top-0 border-start-0 border-end-0 border-dashed border">
									<div class="row align-items-center">
										<div class="col">
											<h6 class="m-0 fw-semibold fs-15">Web Apps</h6>
										</div>
										<div class="col-auto">
											<a href="#!" class="btn btn-sm btn-soft-info"> View All
												Apps <i class="ri-arrow-right-s-line align-middle"></i>
											</a>
										</div>
									</div>
								</div>

								<div class="p-2">
									<div class="row g-0">
										<div class="col">
											<a class="dropdown-icon-item" href="#!"> <img
												src="/assets/images/brands/github.png" alt="Github"> <span>GitHub</span>
											</a>
										</div>
										<div class="col">
											<a class="dropdown-icon-item" href="#!"> <img
												src="/assets/images/brands/bitbucket.png" alt="bitbucket">
												<span>Bitbucket</span>
											</a>
										</div>
										<div class="col">
											<a class="dropdown-icon-item" href="#!"> <img
												src="/assets/images/brands/dribbble.png" alt="dribbble">
												<span>Dribbble</span>
											</a>
										</div>
									</div>

									<div class="row g-0">
										<div class="col">
											<a class="dropdown-icon-item" href="#!"> <img
												src="/assets/images/brands/dropbox.png" alt="dropbox">
												<span>Dropbox</span>
											</a>
										</div>
										<div class="col">
											<a class="dropdown-icon-item" href="#!"> <img
												src="/assets/images/brands/mail_chimp.png" alt="mail_chimp">
												<span>Mail Chimp</span>
											</a>
										</div>
										<div class="col">
											<a class="dropdown-icon-item" href="#!"> <img
												src="/assets/images/brands/slack.png" alt="slack"> <span>Slack</span>
											</a>
										</div>
									</div>
								</div>
							</div>
						</div> -->


						<div class="ms-1 header-item d-none d-sm-flex">
							<span class="nav-link" id="loginTimer">Login on: 00:00:00</span>
						</div>




						<div class="ms-1 header-item d-none d-sm-flex">
							<button type="button"
								class="btn btn-icon btn-topbar btn-ghost-secondary rounded-circle"
								data-toggle="fullscreen">
								<i class='bx bx-fullscreen fs-22'></i>
							</button>
						</div>

						<div class="ms-1 header-item d-none d-sm-flex">
							<button type="button"
								class="btn btn-icon btn-topbar btn-ghost-secondary rounded-circle light-dark-mode">
								<i class='bx bx-moon fs-22'></i>
							</button>
						</div>

						<!----------------------------------- 알림 시작 ----------------------------------------->
						<div class="dropdown topbar-head-dropdown ms-1 header-item"
							id="notificationDropdown">
							<!-- 알림 아이콘 시작 -->
							<button type="button"
								class="btn btn-icon btn-topbar btn-ghost-secondary rounded-circle"
								id="page-header-notifications-dropdown"
								data-bs-toggle="dropdown" data-bs-auto-close="outside"
								aria-haspopup="true" aria-expanded="false">
								<i class='bx bx-bell fs-22'></i> <span id="notification-count" style="display:none;"
									class="position-absolute topbar-badge fs-10 translate-middle badge rounded-pill bg-danger">
									<span id="new-notification-count" th:text="${unreadCount}"></span>
									<span class="visually-hidden">unread messages</span>
								</span>
							</button>
							<!-- 알림 아이콘 끝 -->


							<!-- 알림 드롭메뉴 시작 -->
							<div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0"
								aria-labelledby="page-header-notifications-dropdown">

								<div class="dropdown-head bg-primary bg-pattern rounded-top">
									<div class="p-3">
										<div class="row align-items-center">
											<div class="col">
												<h6 class="m-0 fs-16 fw-semibold text-white">알림</h6>
											</div>
											<div class="col-auto dropdown-tabs">
												<!-- <span class="badge badge-soft-light fs-13"> <span>4</span>개의 새로운 알림
												</span> -->
											</div>
										</div>
									</div>

									<!-- <div class="px-2 pt-2">
										<ul class="nav nav-tabs dropdown-tabs nav-tabs-custom"
											data-dropdown-tabs="true" id="notificationItemsTab"
											role="tablist">
											<li class="nav-item waves-effect waves-light"><a
												class="nav-link active" data-bs-toggle="tab"
												href="#all-noti-tab" role="tab" aria-selected="true"> 알림
													(<span>4</span>)
											</a></li>
											<li class="nav-item waves-effect waves-light"><a
												class="nav-link" data-bs-toggle="tab" href="#schedule-tab"
												role="tab" aria-selected="false"> 일정 </a></li>
											<li class="nav-item waves-effect waves-light"><a
												class="nav-link" data-bs-toggle="tab" href="#approval-tab"
												role="tab" aria-selected="false"> 결재 </a></li>
										</ul>
									</div>
 -->
								</div>

								<div class="tab-content position-relative"
									id="notificationItemsTabContent">
									<!-------------- 전체 알림 시작------------- -->
									<div class="tab-pane fade show active py-2 ps-2" id="all-noti-tab" role="tabpanel">
								        <div data-simplebar style="max-height: 300px;" class="pe-2" id="notificationAllList">
								            <!-- 알림 리스트 반복 시작 -->
								                <div th:each="alarm : ${alarms}" class="text-reset notification-item d-block dropdown-item position-relative">
								                    <div class="d-flex">
								                        <div class="avatar-xs me-3">
								                            <span class="avatar-title bg-soft-info text-info rounded-circle fs-16">
								                                <i class='bx bx-message-square-dots'></i>
								                            </span>
								                        </div>
								                        <div class="flex-1">
								                            <a class="stretched-link" th:href="${alarm.alarmUrl}">
								                                <h6 class="mt-0 mb-2 lh-base">
								                                    <b th:text="${alarm.alarmContext}"></b>
								                                </h6>
								                            </a>
								                            <p class="mb-0 fs-11 fw-medium text-uppercase text-muted">
								                                <i class="mdi mdi-clock-outline"></i> <span th:text="${alarm.alarmCreateTime}"></span>
								                            </p>
								                        </div>
								                        <!-- <div class="px-2 fs-15">
								                            <div class="form-check notification-check">
								                                <input class="form-check-input" type="checkbox" th:id="'alarm-check-' + ${alarm.alarmNo}" th:data-alarm-no="${alarm.alarmNo}">
								                                <label class="form-check-label" th:for="'alarm-check-' + ${alarm.alarmNo}"></label>
								                            </div>
								                        </div> -->
								                    </div>
								                </div>
								                <!-- 삭제 -->
								                <!-- <div class="my-3 text-center">
								                    <button type="button" id='deleteButton' class="btn btn-soft-success waves-light">
								                        삭제
								                    </button>
								                </div> -->
								            </div>
											<!-- 알림 리스트 반복 끝 -->
									</div>

									<!-------------- 전체 알림 끝------------- -->

									<!--------------일정 알림 시작------------- -->
									<!-- <div class="tab-pane fade py-2 ps-2" id="schedule-tab"
										role="tabpanel" aria-labelledby="messages-tab">
										<div data-simplebar style="max-height: 300px;" class="pe-2">

											<div
												class="text-reset notification-item d-block dropdown-item">
												<div class="d-flex">
													<img src="/assets/images/users/avatar-3.jpg"
														class="me-3 rounded-circle avatar-xs" alt="user-pic">
													<div class="flex-1">
														<a href="#!" class="stretched-link">
															<h6 class="mt-0 mb-1 fs-13 fw-semibold">James Lemire</h6>
														</a>
														<div class="fs-13 text-muted">
															<p class="mb-1">We talked about a project on
																linkedin.</p>
														</div>
														<p class="mb-0 fs-11 fw-medium text-uppercase text-muted">
															<span><i class="mdi mdi-clock-outline"></i> 30 min
																ago</span>
														</p>
													</div>
													<div class="px-2 fs-15">
														<div class="form-check notification-check">
															<input class="form-check-input" type="checkbox" value=""
																id="messages-notification-check01"> <label
																class="form-check-label"
																for="messages-notification-check01"></label>
														</div>
													</div>
												</div>
											</div>

											<div
												class="text-reset notification-item d-block dropdown-item">
												<div class="d-flex">
													<img src="/assets/images/users/avatar-2.jpg"
														class="me-3 rounded-circle avatar-xs" alt="user-pic">
													<div class="flex-1">
														<a href="#!" class="stretched-link">
															<h6 class="mt-0 mb-1 fs-13 fw-semibold">Angela
																Bernier</h6>
														</a>
														<div class="fs-13 text-muted">
															<p class="mb-1">Answered to your comment on the cash
																flow forecast's graph 🔔.</p>
														</div>
														<p class="mb-0 fs-11 fw-medium text-uppercase text-muted">
															<span><i class="mdi mdi-clock-outline"></i> 2 hrs
																ago</span>
														</p>
													</div>
													<div class="px-2 fs-15">
														<div class="form-check notification-check">
															<input class="form-check-input" type="checkbox" value=""
																id="messages-notification-check02"> <label
																class="form-check-label"
																for="messages-notification-check02"></label>
														</div>
													</div>
												</div>
											</div>

											<div
												class="text-reset notification-item d-block dropdown-item">
												<div class="d-flex">
													<img src="/assets/images/users/avatar-6.jpg"
														class="me-3 rounded-circle avatar-xs" alt="user-pic">
													<div class="flex-1">
														<a href="#!" class="stretched-link">
															<h6 class="mt-0 mb-1 fs-13 fw-semibold">Kenneth
																Brown</h6>
														</a>
														<div class="fs-13 text-muted">
															<p class="mb-1">Mentionned you in his comment on 📃
																invoice #12501.</p>
														</div>
														<p class="mb-0 fs-11 fw-medium text-uppercase text-muted">
															<span><i class="mdi mdi-clock-outline"></i> 10 hrs
																ago</span>
														</p>
													</div>
													<div class="px-2 fs-15">
														<div class="form-check notification-check">
															<input class="form-check-input" type="checkbox" value=""
																id="messages-notification-check03"> <label
																class="form-check-label"
																for="messages-notification-check03"></label>
														</div>
													</div>
												</div>
											</div>

											<div
												class="text-reset notification-item d-block dropdown-item">
												<div class="d-flex">
													<img src="/assets/images/users/avatar-8.jpg"
														class="me-3 rounded-circle avatar-xs" alt="user-pic">
													<div class="flex-1">
														<a href="#!" class="stretched-link">
															<h6 class="mt-0 mb-1 fs-13 fw-semibold">Maureen
																Gibson</h6>
														</a>
														<div class="fs-13 text-muted">
															<p class="mb-1">We talked about a project on
																linkedin.</p>
														</div>
														<p class="mb-0 fs-11 fw-medium text-uppercase text-muted">
															<span><i class="mdi mdi-clock-outline"></i> 3 days
																ago</span>
														</p>
													</div>
													<div class="px-2 fs-15">
														<div class="form-check notification-check">
															<input class="form-check-input" type="checkbox" value=""
																id="messages-notification-check04"> <label
																class="form-check-label"
																for="messages-notification-check04"></label>
														</div>
													</div>
												</div>
											</div>

											더보기
											<div class="my-3 text-center view-all">
												<button type="button"
													class="btn btn-soft-success waves-effect waves-light">
													View All Messages <i
														class="ri-arrow-right-line align-middle"></i>
												</button>
											</div>

										</div>
									</div>-->
									<!--------------일정 알림 끝------------- -->

									<!--------------결재 알림 시작------------- -->
									<!-- <div class="tab-pane fade py-2 ps-2" id="approval-tab"
										role="tabpanel">
									
									<div class="notification-actions" id="notification-actions" th:each="alarm : ${alarms}" th:if="${alarm.alarmType == 'APPROVAL'}" >
										<div class="d-flex text-muted justify-content-center" >
											<div class="flex-1">
														<a class="stretched-link" th:href="${alarm.alarmUrl}">
															<h6 class="mt-0 mb-2 lh-base">
																<b th:text="${alarm.alarmContext}"></b>
															</h6>
														</a>
														<p class="mb-0 fs-11 fw-medium text-uppercase text-muted">
															<i class="mdi mdi-clock-outline"></i> <span
																th:text="${alarm.alarmCreateTime}"></span>
														</p>
													</div>
													<div class="px-2 fs-15">
														<div class="form-check notification-check">
															<input class="form-check-input" type="checkbox"
																th:id="'alarm-check-' + ${alarm.alarmNo}"
																th:data-alarm-no="${alarm.alarmNo}"> <label
																class="form-check-label"
																th:for="'alarm-check-' + ${alarm.alarmNo}"></label>
														</div>
													</div>
													<div class="my-3 text-center view-all">
												<button type="button"
													class="btn btn-soft-success waves-effect waves-light">
													삭제 
												</button>
											</div>
							</div>
							</div>
							</div> -->
									<!--------------결재 알림 끝 ------------- -->
							</div>
						</div>
						</div>
						<!-- 알림 드롭 메뉴 끝 -->
						<!----------------------------------- 알림 끝 ----------------------------------------->
						
						<div class="dropdown ms-sm-3 header-item topbar-user">
							<button type="button" class="btn" data-bs-toggle="dropdown"
								aria-haspopup="true" aria-expanded="false">
								<span class="d-flex align-items-center"> <!-- 프로필 이미지: 조건부 표현식 사용 -->
									<img class="rounded-circle header-profile-user"
									th:if="${empDto != null and empDto.empProfilePicture != null}"
									th:src="${empDto.empProfilePicture}" alt="Header Avatar"
									width="40" height="40"> <img
									class="rounded-circle header-profile-user"
									th:unless="${empDto != null and empDto.empProfilePicture != null}"
									src="/assets/images/users/user-dummy-img.jpg" alt="Header Avatar"
									width="40" height="40"> <span class="text-start ms-xl-2">
										<span
										class="d-none d-xl-inline-block ms-1 fw-medium user-name-text">
											<span th:text="${empDto != null ? empDto.empName : 'Guest'}"></span>
											<span th:text="${empDto != null ? empDto.jobName : ''}"></span>
									</span> <span
										class="d-none d-xl-block ms-1 fs-12 text-muted user-name-sub-text">
											<span th:text="${empDto != null ? empDto.deptName : ''}"></span>
									</span>
								</span>
								</span>
							</button>
							<div class="dropdown-menu dropdown-menu-end">
								<!-- item-->
								<h6 class="dropdown-header">어서오세요!</h6>

								<a class="dropdown-item" href="/mypage">

								<i class="mdi mdi-account-circle text-muted fs-16 align-middle me-1"></i> <span
										class="align-middle">마이페이지</span></a>
								<a class="dropdown-item" href="/chatList"><i
										class="mdi mdi-message-text-outline text-muted fs-16 align-middle me-1"></i>
									<span class="align-middle">채팅</span></a>
								
								<div class="dropdown-divider"></div>
								
								
								<a class="dropdown-item" href="/auth-signin-basic"><i
										class="mdi mdi-logout text-muted fs-16 align-middle me-1"></i> <span
										class="align-middle" data-key="t-logout">로그아웃</span></a>

							</div>
						</div>
					</div>
				</div>
			</div>
		</header>

		<!-- removeNotificationModal -->
		<div id="removeNotificationModal" class="modal fade zoomIn"
			tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close" id="NotificationModalbtn-close"></button>
					</div>
					<div class="modal-body">
						<div class="mt-2 text-center">
							<lord-icon src="https://cdn.lordicon.com/gsqxdxog.json"
								trigger="loop" colors="primary:#f7b84b,secondary:#f06548"
								style="width:100px;height:100px"></lord-icon>
							<div class="mt-4 pt-2 fs-15 mx-4 mx-sm-5">
								<h4>Are you sure ?</h4>
								<p class="text-muted mx-4 mb-0">Are you sure you want to
									remove this Notification ?</p>
							</div>
						</div>
						<div class="d-flex gap-2 justify-content-center mt-4 mb-2">
							<button type="button" class="btn w-sm btn-light"
								data-bs-dismiss="modal">Close</button>
							<button type="button" class="btn w-sm btn-danger"
								id="delete-notification">Yes, Delete It!</button>
						</div>
					</div>

				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
		<script>
		 document.addEventListener('DOMContentLoaded', function () {
		        let startTime;

		        // localStorage에서 로그인 시작 시간을 가져옴
		        const storedTime = localStorage.getItem('loginStartTime');
		        if (storedTime) {
		            startTime = parseInt(storedTime, 10);
		        } else {
		            startTime = Date.now(); // 현재 시간을 시작 시간으로 설정
		            localStorage.setItem('loginStartTime', startTime);
		        }

		        // 즉시 업데이트하여 새로고침 시 00:00:00 방지
		        updateLoginTimer();

		        function updateLoginTimer() {
		            const currentTime = Date.now();
		            const elapsed = Math.floor((currentTime - startTime) / 1000);

		            const hours = String(Math.floor(elapsed / 3600)).padStart(2, '0');
		            const minutes = String(Math.floor((elapsed % 3600) / 60)).padStart(2, '0');
		            const seconds = String(elapsed % 60).padStart(2, '0');
		            document.getElementById('loginTimer').textContent = `Login on :: ${hours}:${minutes}:${seconds}`;
		        }

		        // 타이머 시작
		        setInterval(updateLoginTimer, 1000);
		    });
</script>


				</div>
				<!-- /.modal-content -->
	
	
	<script>
	document.addEventListener("DOMContentLoaded", function() {
	    // 알림 읽음 처리하는 부분
	    const checkboxes = document.querySelectorAll('.notification-check .form-check-input');

	    checkboxes.forEach(checkbox => {
	        checkbox.addEventListener('change', function(event) {
	            if (event.target.checked) {
	                const alarmNo = event.target.getAttribute('data-alarm-no');
	                fetch(`/api/alarms/read/${alarmNo}`, { // 엔드포인트 수정
	                    method: 'POST' // HTTP 메서드 수정
	                })
	                .then(response => {
	                    if (response.ok) {
	                        // 알림 개수 업데이트
	                        let countElement = document.getElementById('new-notification-count');
	                        let currentCount = parseInt(countElement.textContent);
	                        countElement.textContent = currentCount > 0 ? currentCount - 1 : 0;

	                        // 배지 업데이트
	                        let badge = document.getElementById('notification-count');
	                        let badgeCount = parseInt(document.getElementById('new-notification-count').textContent);
	                        badge.textContent = badgeCount > 0 ? badgeCount : '';
	                    } else {
	                        console.error('Failed to mark alarm as read');
	                    }
	                })
	                .catch(error => console.error('Error updating alarm:', error));
	            }
	        });
	    });
	});

</script>

</body>

</html>